<%- include('partials/h-user.ejs') %>
    <div style="padding: 30 0; background-color: #aec7be;" ;>
        <div class="container">
            <div class="row">
                <div class="col-4">
                    <div class="d-flex justify-content-end px-2">
                        <img src="<%= music.image %>" style="width: 170" id="icon" />
                    </div>
                </div>

                <div class="col-8 d-flex align-items-center">
                    <div class="row">
                        <h2 class="text-light">
                            <%= music.music %>
                        </h2>
                        <h4 class="text-light">
                            <%= music.name %>
                        </h4>
                        
                        <audio controls>
                            <source src="<%= music.audio %>" type="audio/mp3">
                        </audio> 
                        
                    </div>
                </div>

                <div style="width: 50px; height: 50px;"></div>
                <div class="audio-player">
                    <div class="timeline">
                    </div>
                    <div class="controls">
                        <div class="play-container">
                            <div class="toggle-play play"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div style="width: 100%; height: 100%; overflow-y: scroll; ">  
    <pre class="card p-5">
        <%= music.melody %>
    </pre>
</div>

    <style>

        pre {
            font-family: "Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif;
            text-align: center;
            font-size: 16px;
        }
        audio {
            width: 100px;
            height: 35px;
        }

        .row>* {
            -ms-flex-negative: 0;
            flex-shrink: 0;
            width: 400px;
            max-width: 100%;
            padding-right: calc(var(--bs-gutter-x)/2);
            padding-left: calc(var(--bs-gutter-x)/2);
            margin-top: var(--bs-gutter-y);
        }

        .text-light {
            color: #2852bd!important;
        }

        .text-light:hover {
            color: #00a151!important;
        }
        h2 {
            font-family: "Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif;
            font-size: 40px;
            color: rgb(173, 16, 16);
            text-align: center;
            text-transform: uppercase;
            text-rendering: optimizeLegibility;
        }

        h2.elegantshadow {
            color: #131313;
            background-color: #e7e5e4;
            letter-spacing: 0.15em;
            text-shadow: 1px -1px 0 #767676, -1px 2px 1px #737272, -2px 4px 1px #767474, -3px 6px 1px #787777, -4px 8px 1px #7b7a7a, -5px 10px 1px #7f7d7d, -6px 12px 1px #828181, -7px 14px 1px #868585, -8px 16px 1px #8b8a89, -9px 18px 1px #8f8e8d, -10px 20px 1px #949392, -11px 22px 1px #999897, -12px 24px 1px #9e9c9c, -13px 26px 1px #a3a1a1, -14px 28px 1px #a8a6a6, -15px 30px 1px #adabab, -16px 32px 1px #b2b1b0, -17px 34px 1px #b7b6b5, -18px 36px 1px #bcbbba, -19px 38px 1px #c1bfbf, -20px 40px 1px #c6c4c4, -21px 42px 1px #cbc9c8, -22px 44px 1px #cfcdcd, -23px 46px 1px #d4d2d1, -24px 48px 1px #d8d6d5, -25px 50px 1px #dbdad9, -26px 52px 1px #dfdddc, -27px 54px 1px #e2e0df, -28px 56px 1px #e4e3e2;
        }

        h4 {
            font-family: "Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif;
            font-size: 20px;
            text-align: center;
            text-transform: uppercase;
            text-rendering: optimizeLegibility;
        }

        h4.elegantshadow {
            color: #131313;
            background-color: #e7e5e4;
            letter-spacing: 0.15em;
            text-shadow: 1px -1px 0 #767676, -1px 2px 1px #737272, -2px 4px 1px #767474, -3px 6px 1px #787777, -4px 8px 1px #7b7a7a, -5px 10px 1px #7f7d7d, -6px 12px 1px #828181, -7px 14px 1px #868585, -8px 16px 1px #8b8a89, -9px 18px 1px #8f8e8d, -10px 20px 1px #949392, -11px 22px 1px #999897, -12px 24px 1px #9e9c9c, -13px 26px 1px #a3a1a1, -14px 28px 1px #a8a6a6, -15px 30px 1px #adabab, -16px 32px 1px #b2b1b0, -17px 34px 1px #b7b6b5, -18px 36px 1px #bcbbba, -19px 38px 1px #c1bfbf, -20px 40px 1px #c6c4c4, -21px 42px 1px #cbc9c8, -22px 44px 1px #cfcdcd, -23px 46px 1px #d4d2d1, -24px 48px 1px #d8d6d5, -25px 50px 1px #dbdad9, -26px 52px 1px #dfdddc, -27px 54px 1px #e2e0df, -28px 56px 1px #e4e3e2;
        }
    </style>

    <script>
        // var mySong = document.getElementById("mySong");
        // var icon = document.getElementById("icon");

        // icon.onclick = function () {
        //     if (mySong.paused) {
        //         mySong.play();
        //         icon.scr = "https://i.pinimg.com/564x/c3/2e/13/c32e1353bffae1e469354d6c1255d4ab.jpg";
        //     } else {
        //         mySong.pause();
        //         icon.scr = "https://i.pinimg.com/564x/c3/2e/13/c32e1353bffae1e469354d6c1255d4ab.jpg";
        //     }
        // }
        const audioPlayer = document.querySelector(".audio-player");
        const audio = new Audio("<%= music.audio %>");

        console.dir(audio);

        audio.addEventListener(
            "loadeddata",
            () => {
                audioPlayer.querySelector(".time .length").textContent = getTimeCodeFromNum(
                    audio.duration
                );
                audio.volume = 0.75;
            },
            false
        );

        //click on timeline to skip around
        const timeline = audioPlayer.querySelector(".timeline");
        timeline.addEventListener(
            "click",
            (e) => {
                const timelineWidth = window.getComputedStyle(timeline).width;
                const timeToSeek = (e.offsetX / parseInt(timelineWidth)) * audio.duration;
                audio.currentTime = timeToSeek;
            },
            false
        );

        //click volume slider to change volume
        const volumeSlider = audioPlayer.querySelector(".controls .volume-slider");
        volumeSlider.addEventListener(
            "click",
            (e) => {
                const sliderWidth = window.getComputedStyle(volumeSlider).width;
                const newVolume = e.offsetX / parseInt(sliderWidth);
                audio.volume = newVolume;
                audioPlayer.querySelector(".controls .volume-percentage").style.width =
                    newVolume * 100 + "%";
            },
            false
        );

        //check audio percentage and update time accordingly
        setInterval(() => {
            const progressBar = audioPlayer.querySelector(".progress");
            progressBar.style.width = (audio.currentTime / audio.duration) * 100 + "%";
            audioPlayer.querySelector(".time .current").textContent = getTimeCodeFromNum(
                audio.currentTime
            );
        }, 500);


    </script>
    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.js"></script>
<%- include('partials/footer.ejs') %>